const t=t=>({_tag:"Hex",value:t}),e=(t,e,r,n)=>({_tag:"Hsla",h:t,s:e,l:r,a:n}),r=(t,r,n)=>e(t,r,n,1),n=r(0,0,0),o=r(360,1,1),s=t=>{switch(t._tag){case"Hex":return t.value;case"Hsla":{const{h:e,s:r,l:n,a:o}=t,s=t=>Math.round(100*t)/100,i=s(e),a=s(100*r)+"%",c=s(100*n)+"%",l=String(o);return 1===o?`hsl(${i}, ${a}, ${c})`:`hsla(${i}, ${a}, ${c}, ${l})`}}};var i=Object.freeze({__proto__:null,black:n,hex:t,hsl:r,hsla:e,toCss:s,white:o});const a=function(t,e){if("function"==typeof t)return function(){return t(arguments)?e.apply(this,arguments):t=>e(t,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(t,r){return arguments.length>=2?e(t,r):function(r){return e(r,t)}};case 3:return function(t,r,n){return arguments.length>=3?e(t,r,n):function(n){return e(n,t,r)}};case 4:return function(t,r,n,o){return arguments.length>=4?e(t,r,n,o):function(o){return e(o,t,r,n)}};case 5:return function(t,r,n,o,s){return arguments.length>=5?e(t,r,n,o,s):function(s){return e(s,t,r,n,o)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const r=arguments;return function(t){return e(t,...r)}}}},c=t=>t,l=t=>()=>t;function u(t,e,r,n,o,s,i,a,c){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return r(e(t));case 4:return n(r(e(t)));case 5:return o(n(r(e(t))));case 6:return s(o(n(r(e(t)))));case 7:return i(s(o(n(r(e(t))))));case 8:return a(i(s(o(n(r(e(t)))))));case 9:return c(a(i(s(o(n(r(e(t))))))));default:{let t=arguments[0];for(let e=1;e<arguments.length;e++)t=arguments[e](t);return t}}}function f(t,e,r,n,o,s,i,a,c){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return r(e(t.apply(this,arguments)))};case 4:return function(){return n(r(e(t.apply(this,arguments))))};case 5:return function(){return o(n(r(e(t.apply(this,arguments)))))};case 6:return function(){return s(o(n(r(e(t.apply(this,arguments))))))};case 7:return function(){return i(s(o(n(r(e(t.apply(this,arguments)))))))};case 8:return function(){return a(i(s(o(n(r(e(t.apply(this,arguments))))))))};case 9:return function(){return c(a(i(s(o(n(r(e(t.apply(this,arguments)))))))))}}}const h=()=>"3.5.7",g=Symbol.for(`effect/GlobalValue/globalStoreId/${h()}`);g in globalThis||(globalThis[g]=new Map);const p=globalThis[g],d=(t,e)=>(p.has(t)||p.set(t,e()),p.get(t)),y=t=>"function"==typeof t,b=a(2,((t,e)=>{return((t=>"object"==typeof t&&null!==t)(r=t)||y(r))&&e in t;var r}));let m=class t{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new t(this.self)}};const _=Symbol.for("effect/Utils/YieldWrap");class S{#t;constructor(t){this.#t=t}[_](){return this.#t}}const v=d("effect/Utils/isStructuralRegion",(()=>({enabled:!1,tester:void 0}))),w=d(Symbol.for("effect/Hash/randomHashCache"),(()=>new WeakMap)),O=Symbol.for("effect/Hash"),M=t=>{if(!0===v.enabled)return 0;switch(typeof t){case"number":return A(t);case"bigint":return C(t.toString(10));case"boolean":case"symbol":return C(String(t));case"string":return C(t);case"undefined":return C("undefined");case"function":case"object":return null===t?C("null"):t instanceof Date?M(t.toISOString()):x(t)?t[O]():k(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},k=t=>(w.has(t)||w.set(t,A(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),w.get(t)),j=t=>e=>53*e^t,E=t=>3221225471&t|t>>>1&1073741824,x=t=>b(t,O),A=t=>{if(t!=t||t===1/0)return 0;let e=0|t;for(e!==t&&(e^=4294967295*t);t>4294967295;)e^=t/=4294967295;return E(t)},C=t=>{let e=5381,r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return E(e)},N=t=>{let e=6151;for(let r=0;r<t.length;r++)e=u(e,j(M(t[r])));return E(e)},J=function(){if(1===arguments.length){const t=arguments[0];return function(e){return Object.defineProperty(t,O,{value:()=>e,enumerable:!1}),e}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,O,{value:()=>e,enumerable:!1}),e},I=Symbol.for("effect/Equal");function T(){return 1===arguments.length?t=>P(t,arguments[0]):P(arguments[0],arguments[1])}function P(t,e){if(t===e)return!0;const r=typeof t;if(r!==typeof e)return!1;if("object"===r||"function"===r){if(null!==t&&null!==e){if($(t)&&$(e))return!(M(t)!==M(e)||!t[I](e))||!(!v.enabled||!v.tester)&&v.tester(t,e);if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString()}if(v.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every(((t,r)=>P(t,e[r])));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),n=Object.keys(e);if(r.length===n.length){for(const n of r)if(!(n in e)||!P(t[n],e[n]))return!!v.tester&&v.tester(t,e);return!0}}return!!v.tester&&v.tester(t,e)}}return!(!v.enabled||!v.tester)&&v.tester(t,e)}const $=t=>b(t,I),L=Symbol.for("nodejs.util.inspect.custom"),R=t=>b(t,"toJSON")&&y(t.toJSON)&&0===t.toJSON.length?t.toJSON():Array.isArray(t)?t.map(R):t,D=t=>JSON.stringify(t,null,2),W=(t,e)=>{let r=[];const n=JSON.stringify(t,((t,e)=>"object"==typeof e&&null!==e?r.includes(e)?void 0:r.push(e)&&e:e),e);return r=void 0,n},Y=(t,e)=>{switch(e.length){case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let r=t;for(let t=0,n=e.length;t<n;t++)r=e[t](r);return r}}},F=Symbol.for("effect/Effect"),H=Symbol.for("effect/Stream"),B=Symbol.for("effect/Sink"),z=Symbol.for("effect/Channel"),X={_R:t=>t,_E:t=>t,_A:t=>t,_V:h()},Z={[F]:X,[H]:X,[B]:{_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},[z]:{_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},[I](t){return this===t},[O](){return J(this,k(this))},[Symbol.iterator](){return new m(new S(this))},pipe(){return Y(this,arguments)}},U=Symbol.for("effect/Option"),G={...Z,[U]:{_A:t=>t},[L](){return this.toJSON()},toString(){return D(this.toJSON())}},V=Object.assign(Object.create(G),{_tag:"Some",_op:"Some",[I](t){return Q(t)&&et(t)&&T(this.value,t.value)},[O](){return J(this,j(M(this._tag))(M(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:R(this.value)}}}),q=M("None"),K=Object.assign(Object.create(G),{_tag:"None",_op:"None",[I]:t=>Q(t)&&tt(t),[O]:()=>q,toJSON(){return{_id:"Option",_tag:this._tag}}}),Q=t=>b(t,U),tt=t=>"None"===t._tag,et=t=>"Some"===t._tag,rt=Object.create(K),nt=Symbol.for("effect/Either"),ot={...Z,[nt]:{_R:t=>t},[L](){return this.toJSON()},toString(){return D(this.toJSON())}},st=Object.assign(Object.create(ot),{_tag:"Right",_op:"Right",[I](t){return at(t)&&lt(t)&&T(this.right,t.right)},[O](){return j(M(this._tag))(M(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:R(this.right)}}}),it=Object.assign(Object.create(ot),{_tag:"Left",_op:"Left",[I](t){return at(t)&&ct(t)&&T(this.left,t.left)},[O](){return j(M(this._tag))(M(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:R(this.left)}}}),at=t=>b(t,nt),ct=t=>"Left"===t._tag,lt=t=>"Right"===t._tag,ut=()=>rt,ft=t=>{const e=Object.create(V);return e.value=t,e},ht=tt,gt=et,pt=t=>null==t?ut():ft(t),dt=a(2,((t,e)=>{if(gt(t))return t.value;throw e()})),yt=t=>{const e=Object.create(st);return e.right=t,e},bt=t=>{const e=Object.create(it);return e.left=t,e},mt=ct,_t=(t,e)=>t<=e?((t,e)=>{const r=Math.max(1,Math.floor(t)),n=new Array(r);for(let t=0;t<r;t++)n[t]=e(t);return n})(e-t+1,(e=>t+e)):[t],St=t=>Array.isArray(t)?t:Array.from(t),vt=a(2,((t,{onEmpty:e,onNonEmpty:r})=>Mt(t)?r(jt(t),xt(t)):e())),wt=a(2,((t,e)=>[...t,e])),Ot=t=>0===t.length,Mt=t=>t.length>0,kt=a(2,((t,e)=>{const r=Math.floor(e);if(((t,e)=>t<0||t>=e.length)(r,t))throw new Error(`Index ${r} out of bounds`);return t[r]})),jt=kt(0),Et=t=>t[t.length-1],xt=t=>t.slice(1),At=a(3,((t,e,r)=>{const n=St(t),o=St(e);if(Mt(n)&&Mt(o)){const t=[r(jt(n),jt(o))],e=Math.min(n.length,o.length);for(let s=1;s<e;s++)t[s]=r(n[s],o[s]);return t}return[]})),Ct=a(2,((t,e)=>wt((t=>t.slice(0,-1))(t),e(Et(t))))),Nt=a(2,((t,e)=>Ct(t,(()=>e)))),Jt=()=>[],It=a(2,((t,e)=>t.map(e))),Tt=a(2,((t,e)=>{if(Ot(t))return[];const r=[];for(let n=0;n<t.length;n++){const o=e(t[n],n);for(let t=0;t<o.length;t++)r.push(o[t])}return r})),Pt=a(2,((t,e)=>{const r=St(t),n=[];for(let t=0;t<r.length;t++){const o=e(r[t],t);gt(o)&&n.push(o.value)}return n})),$t=a(2,((t,e)=>{const r=[],n=[],o=St(t);for(let t=0;t<o.length;t++){const s=e(o[t],t);mt(s)?r.push(s.left):n.push(s.right)}return[r,n]})),Lt=a(3,((t,e,r)=>St(t).reduce(((t,e,n)=>r(t,e,n)),e))),Rt=(t,e)=>{const r=[];let n,o=t;for(;gt(n=e(o));){const[t,e]=n.value;r.push(t),o=e}return r};const Dt=t=>e=>{const r=Object.keys(e);return t.imap(t.productAll(r.map((t=>e[t]))),(t=>{const e={};for(let n=0;n<t.length;n++)e[r[n]]=t[n];return e}),(t=>r.map((e=>t[e]))))},Wt=(t,e=(e,r)=>{return(n=e,o=t,function(t){if(Array.isArray(t))return t.reduce(o,n);let e=n;for(const r of t)e=o(e,r);return e})(r);var n,o})=>({combine:t,combineMany:e}),Yt=()=>Wt((t=>t),(t=>t)),Ft=t=>Wt(((e,r)=>{const n=Math.min(e.length,r.length),o=[];let s=0;for(const i of t){if(s>=n)break;o.push(i.combine(e[s],r[s])),s++}return o})),Ht=Dt({of:t=>Wt((()=>t),(()=>t)),imap:a(3,((t,e,r)=>Wt(((n,o)=>e(t.combine(r(n),r(o)))),((n,o)=>{return e(t.combineMany(r(n),(s=r,function(t){return Array.isArray(t)?t.map(s):function*(){for(const e of t)yield s(e)}()})(o)));var s})))),product:(t,e)=>Wt((([r,n],[o,s])=>[t.combine(r,o),e.combine(n,s)])),productMany:(t,e)=>{const r=Ft(e);return Wt(((e,n)=>[t.combine(e[0],n[0]),...r.combine(e.slice(1),n.slice(1))]))},productAll:Ft}),Bt=(t,e)=>({combine:t.combine,combineMany:t.combineMany,empty:e,combineAll:r=>t.combineMany(e,r)}),zt=t=>{const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r].empty);return Bt(Ht(t),e)},Xt={partitionMap:$t,filterMap:Pt},Zt={reduce:Lt},Ut=()=>Bt(Wt(((t,e)=>t.concat(e))),[]),Gt=t=>Bt(Wt(((e,r)=>ht(e)?r:ht(r)?e:ft(t.combine(e.value,r.value)))),ut()),Vt=(t,e,r,n)=>({_tag:"Translate",translateX:t,translateY:e,translateZ:r,drawing:n}),qt=(t,e,r,n)=>({_tag:"Rotate",rotateX:t,rotateY:e,rotateZ:r,drawing:n}),Kt=(t,e,r,n)=>({_tag:"Scale",scaleX:t,scaleY:e,scaleZ:r,drawing:n}),Qt=t=>({_tag:"Many",drawings:t}),te=t=>({color:ft(t),lineWidth:ut(),lineCap:ut(),lineJoin:ut()}),ee=t=>({color:ut(),lineCap:ft(t),lineWidth:ut(),lineJoin:ut()}),re=(t,e)=>({_tag:"Fill",shape:t,style:e}),ne=t=>({color:ft(t)}),oe=(t,e)=>({_tag:"Outline",shape:t,style:e}),se=Gt(Yt()),ie=Gt(Yt()),ae=Gt(Yt()),ce=Gt(Yt()),le=zt({color:se}),ue=zt({color:se,lineWidth:ce,lineCap:ie,lineJoin:ae}),{combineAll:fe,empty:he}=Ut(),ge=Bt(Wt(((t,e)=>"Many"===t._tag&&"Many"===e._tag?Qt(fe([t.drawings,e.drawings])):"Many"===t._tag?Qt(fe([t.drawings,[e]])):"Many"===e._tag?Qt(fe([[t],e.drawings])):Qt([t,e]))),Qt(he));var pe=Object.freeze({__proto__:null,clipped:(t,e)=>({_tag:"Clipped",shape:t,drawing:e}),fill:re,fillStyle:ne,lineCap:ee,lineJoin:t=>({color:ut(),lineJoin:ft(t),lineWidth:ut(),lineCap:ut()}),lineWidth:t=>({color:ut(),lineWidth:ft(t),lineCap:ut(),lineJoin:ut()}),many:Qt,monoidDrawing:ge,monoidFillStyle:le,monoidOutlineStyle:ue,outline:oe,outlineColor:te,rotate:qt,scale:Kt,translate:Vt});const de=Bt(Wt(((t,e)=>t||e),((t,e)=>{if(!0===t)return!0;for(const t of e)if(!0===t)return!0;return!1})),!1),ye=t=>({_tag:"Degrees",degrees:t}),be=(t,e,r)=>[t,e,r],me=t=>({_tag:"Composite",shapes:t}),_e=t=>e=>t.reduce(e,we.empty,((t,e)=>({_tag:"Path",closed:!0,points:wt(e)(t.points)}))),Se=t=>e=>t.reduce(e,we.empty,((t,e)=>({_tag:"Path",closed:!1,points:wt(e)(t.points)}))),ve=t=>{switch(t._tag){case"Radians":return t.radians*(180/Math.PI);case"Degrees":return t.degrees}},we=zt({_tag:Bt(Wt(l("Path")),"Path"),closed:de,points:Ut()});var Oe=Object.freeze({__proto__:null,angle:ve,closed:_e,composite:me,degrees:ye,monoidPath:we,path:Se,point:be,radians:t=>({_tag:"Radians",radians:t})});const Me=Symbol.for("effect/Context/Tag"),ke=Symbol.for("effect/STM"),je={...Z,_tag:"Tag",_op:"Tag",[ke]:X,[Me]:{_Service:t=>t,_Identifier:t=>t},toString(){return D(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[L](){return this.toJSON()},of:t=>t,context(t){return Je(this,t)}},Ee=Symbol.for("effect/Context"),xe={[Ee]:{_Services:t=>t},[I](t){if(Ce(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!T(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[O](){return J(this,A(this.unsafeMap.size))},pipe(){return Y(this,arguments)},toString(){return D(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(R)}},[L](){return this.toJSON()}},Ae=t=>{const e=Object.create(xe);return e.unsafeMap=t,e},Ce=t=>b(t,Ee),Ne=Ae(new Map),Je=(t,e)=>Ae(new Map([[t.key,e]])),Ie=a(3,((t,e,r)=>{const n=new Map(t.unsafeMap);return n.set(e.key,r),Ae(n)})),Te=()=>Ne,Pe=Ie,$e=a(2,((t,e)=>{if(!t.unsafeMap.has(e.key))throw(t=>{const e=new Error("Service not found"+(t.key?`: ${String(t.key)}`:""));if(t.stack){const r=t.stack.split("\n");if(r.length>2){const t=r[2].match(/at (.*)/);t&&(e.message=e.message+` (defined at ${t[1]})`)}}if(e.stack){const t=e.stack.split("\n");t.splice(1,3),e.stack=t.join("\n")}return e})(e);return t.unsafeMap.get(e.key)})),Le=t=>()=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;function n(){}return Error.stackTraceLimit=e,Object.setPrototypeOf(n,je),n.key=t,Object.defineProperty(n,"stack",{get:()=>r.stack}),n},Re=Z;class De{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new De(this.self)}}const We=Symbol.for("effect/Micro"),Ye=Symbol.for("effect/Micro/runSymbol"),Fe=t=>"object"==typeof t&&null!==t&&We in t,He=Symbol.for("effect/Micro/MicroCause"),Be={_E:c};class ze extends globalThis.Error{_tag;traces;[He];constructor(t,e,r){const n=`MicroCause.${t}`;let o,s,i;if(e instanceof globalThis.Error){o=`(${n}) ${e.name}`,s=e.message;const t=s.split("\n").length;i=e.stack?`(${n}) ${e.stack.split("\n").slice(0,t+3).join("\n")}`:`${o}: ${s}`}else o=n,s=((t,e=2)=>{try{return"object"==typeof t?W(t,e):String(t)}catch(e){return String(t)}})(e,0),i=`${o}: ${s}`;r.length>0&&(i+=`\n    ${r.join("\n    ")}`),super(s),this._tag=t,this.traces=r,this[He]=Be,this.name=o,this.stack=i}pipe(){return Y(this,arguments)}toString(){return this.stack}[L](){return this.stack}}class Xe extends ze{defect;constructor(t,e=[]){super("Die",t,e),this.defect=t}}class Ze extends ze{constructor(t=[]){super("Interrupt","interrupted",t)}}const Ue=bt(((t=[])=>new Ze(t))()),Ge=yt,Ve=t=>bt(((t,e=[])=>new Xe(t,e))(t)),qe=Symbol.for("effect/Micro/Env"),Ke=Symbol.for("effect/Micro/EnvRef"),Qe={[qe]:{_R:c},pipe(){return Y(this,arguments)}},tr=t=>{const e=Object.create(Qe);return e.refs=t,e},er=a(2,((t,e)=>e.key in t.refs?t.refs[e.key]:e.initial)),rr=a(3,((t,e,r)=>{const n=Object.assign(Object.create(null),t.refs);return n[e.key]=r,tr(n)})),nr=a(2,((t,e)=>tr(e(Object.assign(Object.create(null),t.refs))))),or=a(3,((t,e,r)=>yr((function(n,o){const s=er(n,lr),i=rr(n,lr,Pe(s,e,r));t[Ye](i,o)})))),sr={[Ke]:Ke},ir=(t,e)=>d(t,(()=>{const r=Object.create(sr);return r.key=t,r.initial=e(),r})),ar=ir("effect/Micro/currentAbortController",(()=>{})),cr=ir("effect/Micro/currentAbortSignal",(()=>{})),lr=ir("effect/Micro/currentContext",(()=>Te())),ur=ir("effect/Micro/currentConcurrency",(()=>"unbounded")),fr=ir("effect/Micro/currentMaxDepthBeforeYield",(()=>2048)),hr=ir("effect/Micro/currentInterruptible",(()=>!0)),gr={...Re,_op:"Micro",[We]:{_A:c,_E:c,_R:c},[Symbol.iterator](){return new De(new S(this))}},pr=d("effect/Micro/microDepthState",(()=>({depth:0,maxDepthBeforeYield:fr.initial}))),dr=(t,e)=>(t=>{const e=Object.create(gr);return e[Ye]=t,e})((function r(n,o){if(e&&!1!==n.refs[hr.key]&&n.refs[cr.key].aborted)return o(Ue);if(pr.depth++,1===pr.depth&&(pr.maxDepthBeforeYield=er(n,fr)),pr.depth>=pr.maxDepthBeforeYield)Mr((()=>r(n,o)));else try{t(n,o)}catch(t){o(Ve(t))}pr.depth--})),yr=t=>dr(t,!0),br=t=>yr((function(e,r){r(t)})),mr=t=>br(Ge(t)),_r=t=>yr((function(e,r){r(Ge(t()))})),Sr=t=>yr((function(e,r){t()[Ye](e,r)})),vr=d("effect/Micro/yieldState",(()=>({tasks:[],working:!1}))),wr=()=>{const t=vr.tasks;vr.tasks=[];for(let e=0,r=t.length;e<r;e++)t[e]()},Or="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0),Mr=t=>{vr.tasks.push(t),vr.working||(vr.working=!0,Or((()=>{vr.working=!1,wr()})))},kr=a(2,((t,e)=>yr((function(r,n){t[Ye](r,(function(t){if("Left"===t._tag)return n(t);e(t.right)[Ye](r,n)}))})))),jr=a(2,((t,e)=>yr((function(r,n){t[Ye](r,(function(t){if("Left"===t._tag)return n(t);if(er(r,cr).aborted)return n(Ue);const o=Fe(e)?e:"function"==typeof e?e(t.right):e;Fe(o)?o[Ye](r,n):n(Ge(o))}))}))));const Er=t=>dr((function(e,r){const n=nr(e,(function(t){return t[hr.key]=!1,t[cr.key]=(new AbortController).signal,t}));t[Ye](n,r)}),!1),xr=(t,e,r)=>yr((function(n,o){const s="inherit"===r?.concurrency?er(n,ur):r?.concurrency??1,i="unbounded"===s?Number.POSITIVE_INFINITY:Math.max(1,s),[a,c]=function(t){const e=new AbortController,r=er(t,cr);function n(){e.abort(),r.removeEventListener("abort",n)}return r.addEventListener("abort",n),[nr(t,(function(t){return t[ar.key]=e,t[cr.key]=e.signal,t})),n]}(n);let l;const u=Array.from(t);let f=u.length;const h=r?.discard?void 0:new Array(f);let g=0,p=0,d=0,y=!1;!function t(){for(y=!0;p<i&&g<f;){const r=g,n=u[r];g++,p++;try{e(n,r)[Ye](a,(function(e){"Left"===e._tag?void 0===l&&(l=e,f=g,c()):void 0!==h&&(h[r]=e.right),d++,p--,d===f?o(l??yt(h)):!y&&p<i&&t()}))}catch(t){l=Ve(t),f=g,c()}}y=!1}()})),Ar=Symbol.for("effect/Micro/Handle");class Cr{parentSignal;[Ar];observers=new Set;_exit=void 0;_controller;isRoot;constructor(t,e){this.parentSignal=t,this[Ar]=Ar,this.isRoot=void 0!==e,this._controller=e??new AbortController,this.isRoot||t.addEventListener("abort",this.unsafeInterrupt)}unsafePoll(){return this._exit??null}unsafeInterrupt=()=>{this._controller.abort()};emit(t){this._exit||(this._exit=t,this.isRoot||this.parentSignal.removeEventListener("abort",this.unsafeInterrupt),this.observers.forEach((e=>e(t))),this.observers.clear())}addObserver(t){if(this._exit)return t(this._exit);this.observers.add(t)}removeObserver(t){this.observers.delete(t)}get await(){return Sr((()=>{return this._exit?mr(this._exit):(t=t=>{function e(e){t(mr(e))}return this.addObserver(e),_r((()=>{this.removeObserver(e)}))},yr((function(e,r){let n=!1;const o=t.length>1?new AbortController:void 0,s=er(e,cr);let i;function a(){c(i?Er(jr(i,br(Ue))):br(Ue)),void 0!==o&&o.abort()}function c(t){n||(n=!0,s.removeEventListener("abort",a),t[Ye](e,r))}i=void 0===o?t(c):t(c,o.signal),n||s.addEventListener("abort",a)})));var t}))}get join(){return kr(this.await,br)}get interrupt(){return Sr((()=>(this.unsafeInterrupt(),this.await)))}}const Nr=t=>{const e=(t=>{const e=new AbortController,r=Object.create(null);r[ar.key]=e,r[cr.key]=e.signal;const n=tr(r),o=new Cr(e.signal,e);return t[Ye](rr(n,cr,o._controller.signal),(t=>{o.emit(t)})),o})(t);for(;vr.tasks.length>0;)wr();const r=e.unsafePoll();return null===r?Ve(e):r},Jr=t=>{const e=Nr(t);if("Left"===e._tag)throw e.left;return e.right},Ir=a(2,((t,e)=>t+e)),Tr=a(2,((t,e)=>t*e)),Pr=t=>e=>u(At(e,t,Tr),Lt(0,Ir)),$r=t=>Math.sin(t*Math.PI/180),Lr=t=>Math.cos(t*Math.PI/180),Rr=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],Dr=t=>e=>Wr.combine(e,t),Wr=Wt(((t,e)=>{return u(It(u(jt(r=e),It(((t,e)=>Yr(e)(r)))),Pr),(e=>It(t,(t=>It(e,(e=>e(t)))))));var r}));Bt(Wr,Rr);const Yr=t=>It(kt(t)),Fr=t=>isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2]),Hr=t=>{switch(t._tag){case"Composite":return Zt.reduce(t.shapes,[],((t,e)=>t.concat(Hr(e))));case"Path":return u(t.points,vt({onEmpty:Jt,onNonEmpty:(e,r)=>u(r,It(zr),Lt(Br(e)([]),((t,e)=>e(t))),(e=>t.closed?Xr(e).slice(0,-1):e))}))}},Br=t=>e=>Fr(t)?wt(e,[t]):e,zr=t=>e=>Fr(t)?Mt(e)?u(e,Ct(wt(t))):Br(t)(e):e,Xr=t=>{if(!Mt(t))return t;const e=Et(t);if(!(Mt(e)&&e.length>1))return t;const r=Et(e),n=e[0];return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]?t:wt(Nt(wt(e,n))(t),[n])},Zr=t=>Mt(t)?ft(t):ut(),Ur=Xt.filterMap(c);const Gr=[[1,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,1]],Vr=(t,e)=>u(Hr(t),It(Zr),Ur,It(It(wt(1))),It(Dr(e)),It(Dr(Gr)));class qr extends(Le("Render")()){}const Kr=mr(void 0),Qr=t=>{return(e=qr,yr((function(t,r){r(Ge($e(er(t,lr),e)))}))).pipe(jr((e=>{const r=t=>u(e.save(),jr((()=>t)),jr(e.restore)),n=(t,e)=>gt(t)?e(t.value):Kr,o=vt({onEmpty:()=>Kr,onNonEmpty:(t,r)=>u(e.moveTo(t),jr((()=>xr(r,e.lineTo,{discard:!0}))))}),i=t=>a=>{switch(a._tag){case"Many":return xr(a.drawings,i(t),{discard:!0});case"Scale":return i(Dr([[(c=[a.scaleX,a.scaleY,a.scaleZ])[0],0,0,0],[0,c[1],0,0],[0,0,c[2],0],[0,0,0,1]])(t))(a.drawing);case"Rotate":return i(Wr.combine(Dr((t=>[[1,0,0,0],[0,Lr(t),$r(t),0],[0,-$r(t),Lr(t),0],[0,0,0,1]])(ve(a.rotateX)))((t=>[[Lr(t),0,-$r(t),0],[0,1,0,0],[$r(t),0,Lr(t),0],[0,0,0,1]])(ve(a.rotateY))),Dr((t=>[[Lr(t),$r(t),0,0],[-$r(t),Lr(t),0,0],[0,0,0,0],[0,0,0,1]])(ve(a.rotateZ)))(t)))(a.drawing);case"Translate":return i(Dr((t=>[[1,0,0,0],[0,1,0,0],[0,0,1,0],[t[0],t[1],t[2],1]])([a.translateX,a.translateY,a.translateZ]))(t))(a.drawing);case"Outline":return r(u(n(a.style.color,f(s,e.setStrokeStyle)),jr((()=>n(a.style.lineWidth,e.setLineWidth))),jr((()=>n(a.style.lineCap,e.setLineCap))),jr((()=>n(a.style.lineJoin,e.setLineJoin))),jr(e.beginPath),jr((()=>xr(Vr(a.shape,t),o,{discard:!0}))),jr(e.stroke)));case"Fill":return r(u(n(a.style.color,f(s,e.setFillStyle)),jr(e.beginPath),jr((()=>xr(Vr(a.shape,t),o,{discard:!0}))),jr((()=>e.fill()))));case"Clipped":return r(u(e.beginPath(),jr((()=>xr(Vr(a.shape,t),o,{discard:!0}))),jr((()=>e.clip())),jr((()=>i(t)(a.drawing)))))}var c};return i(Rr)(t)})));var e},tn=t=>_r((()=>pt((t=>document.getElementById(t))(t)))),en=f((t=>t.getContext("2d")),pt,l,_r),rn=mr(window.devicePixelRatio),nn=(t,e)=>u(tn(e),jr(dt((()=>new Error(`Unable to find canvas with id ${e}`)))),jr((e=>{const r=e.getBoundingClientRect();return rn.pipe(jr((n=>(e.width=r.width*n,e.height=r.height*n,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,u(en(e),jr(dt((()=>new Error("Unable to get context 2D")))),jr((r=>(r.scale(n,n),((t,e)=>or(Qr(t),qr,{fill:t=>(void 0!==t?e.fill(t):e.fill(),Kr),clip:t=>(void 0!==t?e.clip(t):e.clip(),Kr),setFillStyle:t=>(e.fillStyle=t,Kr),setStrokeStyle:t=>(e.strokeStyle=t,Kr),setLineWidth:t=>(e.lineWidth=t,Kr),setLineJoin:t=>(e.lineJoin=t,Kr),setLineCap:t=>(e.lineCap=t,Kr),stroke:()=>(e.stroke(),Kr),save:()=>(e.save(),Kr),restore:()=>(e.restore(),Kr),lineTo:t=>(e.lineTo(t[0],t[1]),Kr),moveTo:t=>(e.moveTo(t[0],t[1]),Kr),beginPath:()=>(e.beginPath(),Kr),closePath:()=>(e.closePath(),Kr)}))(t({height:e.height/n,width:e.width/n}),r)))))))))}))).pipe(Jr);export{t as A,Se as B,me as C,Tt as D,be as E,Zt as F,i as G,pe as H,Oe as S,N as a,I as b,J as c,nn as d,T as e,re as f,ne as g,Qt as h,Kt as i,It as j,f as k,ee as l,ue as m,ye as n,te as o,u as p,_e as q,qt as r,O as s,Vt as t,Rt as u,oe as v,o as w,_t as x,ft as y,ut as z};
